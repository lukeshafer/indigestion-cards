---
import type { PackEntity } from '@lil-indigestion-cards/core/pack';
import TiltCardEffect from '@/components/TiltCardEffect.astro';
import { api } from '@/constants';

type Props = {
	pack?: PackEntity;
};

const { pack } = Astro.props
---

{pack === undefined ? (
	<h2 class="font-heading mb-8 text-4xl font-bold uppercase text-gray-700">
		Select a pack to start
	</h2>
) : (
	<h2 class="font-heading mb-8 text-4xl font-bold uppercase text-gray-700">
		Opening pack for <span class="font-display block italic normal-case text-brand-main text-6xl py-4">{pack.username}</span>
	</h2>
	<ul class="flex flex-wrap items-center justify-center gap-12">
		{
			pack.cardDetails.map((card) => (
				<li x-data={`{ flipped: ${card.opened} }`}>
					<p class="error-text" />
					<div
						x-effect="$el.classList.toggle('flipped', flipped)"
						class="perspective preserve-3d relative block h-56 w-40 origin-center transition-transform duration-500">
						<button
							@click="flipped = true"
							hx-patch={api.OPEN_CARD}
							hx-target="previous p.error-text"
							hx-swap="outerHTML"
							hx-vals={JSON.stringify({
								instanceId: card.instanceId,
								designId: card.designId,
							})}
							class="backface-hidden bg-brand-main border-brand-dark absolute inset-0
						h-full w-full cursor-pointer border-4"
							title="Click to reveal"
						/>
						<div class="backface-hidden flipped absolute inset-0 h-full w-full">
							<TiltCardEffect border={card.rarityName.toLowerCase()}>
								<img class="h-56 w-40" src={card.imgUrl} />
							</TiltCardEffect>
						</div>
					</div>
				</li>
			))
		}
	</ul>
)}
