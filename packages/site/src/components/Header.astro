---
import AdminOnly from '@/components/AdminOnly.astro';
import Hamburger from '@/components/Hamburger.astro';
import UserConfig from '@/components/UserConfig';
import UserSearch from '@/components/UserSearch';
import { ASSETS } from '@/constants';
import { getLoginLink } from '@/lib/utils';

const disableAnimations = Astro.cookies.get('disable-animations').boolean();

const currentPage = Astro.url.pathname;

const username = Astro.locals.session?.properties.username;

const headerLinks = [
	{ href: '/card', title: 'Cards' },
	{ href: '/user', title: 'Users' },
];
---

<div class="border-b border-b-gray-300 bg-white">
	<header class="max-w-main mx-auto flex items-center gap-4 px-4 py-2 text-white md:py-4">
		<AdminOnly>
			<div data-for-admin-panel class="toggle-btn z-100 px-2 py-2 text-lg">
				<Hamburger />
			</div>
		</AdminOnly>
		<nav
			class="flex-1 flex text-black items-center gap-2 md:gap-4 overflow-x-scroll scrollbar-hidden">
			<a href="/" title="Home" class="flex items-center gap-4 w-fit min-w-[2rem] mr-4">
				<img src={ASSETS.LOGO} alt="logo" class="w-12 block" width="192" />
				<div class="font-display hidden flex-1 flex-col pt-1 sm:flex">
					<span class="text-brand-main mt-1 text-2xl italic">indigestion</span>
					<span class="-mt-2 text-lg text-gray-700">cards</span>
				</div>
			</a>
			{
				headerLinks.map(({ href, title }) => (
					<a
						href={href}
						title={title}
						class="relative px-2 py-1 hover:bg-gray-200 text-gray-700 rounded transition-colors"
						class:list={{
							'font-bold text-brand-main bg-brand-100': currentPage.startsWith(href),
						}}>
						<span
							class:list={{
								'font-bold text-brand-main': currentPage.startsWith(href),
							}}>
							{title}
						</span>
					</a>
				))
			}
		</nav>
		<UserSearch client:load />
		<UserConfig client:load {disableAnimations} />
		{username ? <p class="text-black">{username}</p> : <a href={getLoginLink({ url: Astro.url })} class="text-brand-main text-xs underline">Login</a> }
		
	</header>
</div>

<style>
	.toggle-btn {
		display: none;
		--color: black;
		--open-color: white;
		--spacing: 0.2em;
		--thickness: 4px;
		--size: 1rem;
		--width: 1.3em;
		--text-value: calc(255 - 255 * var(--isClosed));
		padding-left: 1rem;
		color: rgb(var(--text-value), var(--text-value), var(--text-value));
		z-index: 1;
		background: transparent;
		font-weight: 900;
		transition:
			transform 0.3s ease-in-out,
			color 0.3s ease-in-out;
		align-self: center;
	}

	@media (max-width: 768px) {
		.toggle-btn {
			display: block;
			transform: translateX(calc(var(--isClosed) * 100%));
		}
	}
</style>
