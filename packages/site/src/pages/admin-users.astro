---
import Page from '@/layouts/Page.astro';
import { useAdmin } from '@/session';
import { getAllAdminUsers } from '@lil-indigestion-cards/core/user';
import { routes } from '@/constants';
import AdminUserRow from '@/components/admin-users/AdminUserRow.astro';

const admin = useAdmin(Astro.cookies);
if (!admin) return Astro.redirect(`/404`);

const unsortedUsers = await getAllAdminUsers();

const currentUser = admin.properties.userId;
const users = unsortedUsers.sort((a, b) => {
	if (a.userId === currentUser) return -1;
	if (b.userId === currentUser) return 1;
	return 0;
});
---

<Page
	title="Users"
	breadcrumbs={[{ label: 'Home', href: '/' }, { label: 'Users' }]}
	session={admin}>
	<sort-table>
		<header slot="header" class="page-header">
			<h1 class="page-heading">Admin Users</h1>
			<button
				class="button-link"
				id="new-admin-user"
				hx-get="/api/html/admin/new-admin-form"
				hx-target="next tbody"
				hx-swap="beforeend">Add Admin</button
			>
		</header>
		<table id="#admin-users-table">
			<thead>
				<tr>
					<th class="w-3/4">Username</th>
					<th>Actions</th>
				</tr>
			</thead>
			<tbody>
				{
					users.map(({ username, userId }) => (
						<AdminUserRow {username} {userId} {currentUser} />
					))
				}
			</tbody>
		</table>
	</sort-table>
</Page>
