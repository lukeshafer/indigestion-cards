---
import Page from '@/layouts/Page.astro';
import { getAllAdminUsers } from '@lil-indigestion-cards/core/user';
import AdminUserRow from '@/components/admin-users/AdminUserRow.astro';
import { api } from '@/constants';
import PageHeading from '@/components/text/PageHeading.astro';

const unsortedUsers = await getAllAdminUsers();
const currentUser = Astro.locals.session?.properties?.userId;
const users = unsortedUsers.sort((a, b) => {
	if (a.userId === currentUser) return -1;
	if (b.userId === currentUser) return 1;
	return 0;
});
---

<Page title="Users" breadcrumbs={[{ label: 'Home', href: '/' }, { label: 'Users' }]}>
	<sort-table>
		<header slot="header" class="page-header">
			<PageHeading>Admin Users</PageHeading>
			<button
				class="button-link"
				id="new-admin-user"
				hx-get={api.ADMIN.NEW_ADMIN_FORM}
				hx-target="next tbody"
				hx-swap="beforeend">Add Admin</button
			>
		</header>
		<table id="#admin-users-table">
			<thead>
				<tr>
					<th class="w-3/4">Username</th>
					<th>Actions</th>
				</tr>
			</thead>
			<tbody>
				{
					users.map(({ username, userId, isStreamer }) => (
						<AdminUserRow {username} {userId} {isStreamer} />
					))
				}
			</tbody>
		</table>
	</sort-table>
</Page>
