---
import Page from '@/layouts/Page.astro';
import { getAllPacks } from '@lil-indigestion-cards/core/card';
import TiltCardEffect from '@/components/TiltCardEffect.astro';
import { api } from '@/constants';

const allPacks = await getAllPacks();
const packs = allPacks.filter((pack) => pack.userId && pack.username);
---

<Page title="Open Packs" breadcrumbs={[{ label: 'Home', href: '/' }, { label: 'Open Packs' }]}>
	<div class="grid grid-cols-[auto_1fr]">
		<h1 class="page-heading">Open Packs</h1>
		<section class="my-8 bg-[#dde] p-3 col-start-1" id="pack-list">
			<h2 class="font-semibold text-xl mb-2">Unopened packs:</h2>
			<ul class="packs overflow-y-scroll flex flex-col gap-6 relative pb-2 min-h-[20rem]">
				{
					packs.map((pack) => (
						<li id={pack.packId}>
							<div class="pack-main flex justify-center gap-2 w-60 bg-brand-main p-2">
								<button
									class="text-shadow shine bg-brand-main font-display italic text-white text-xl w-full mx-auto text-center"
									hx-get={api.GET_PACK_TO_OPEN}
									hx-vals={JSON.stringify({ packId: pack.packId })}
									hx-swap="innerHTML"
									hx-target="#open-showcase">
									<h3 class="p-2 pb-1 text-center bg-brand-dark">
										{pack.username}
									</h3>
								</button>
							</div>
						</li>
					))
				}
			</ul>
		</section>
		<div id="open-showcase"></div>
		<TiltCardEffect isTemplateOnly />
	</div>
</Page>

<style>
	#pack-list ul {
		scrollbar-width: auto;
		--scrollbar-color: var(--color-main);
		--scrollbar-track-color: #dde;
		scrollbar-color: var(--scrollbar-color) var(--scrollbar-track-color);
	}

	#pack-list ul::-webkit-scrollbar {
		width: 1rem;
	}

	#pack-list ul::-webkit-scrollbar-track {
		background: var(--scrollbar-track-color);
	}

	#pack-list ul::-webkit-scrollbar-thumb {
		background-color: var(--scrollbar-color);
		border: 3px solid var(--scrollbar-track-color);
		cursor: pointer;
	}

	#pack-list ul::-webkit-scrollbar:hover {
		filter: brightness(1.5);
	}
</style>
