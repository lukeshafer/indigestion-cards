---
import { api } from '@/constants';
import { updateRarity } from '@lil-indigestion-cards/core/card';

const rarityId = Astro.url.searchParams.get('rarityId');
const rarityName = Astro.url.searchParams.get('rarityName');
const defaultCount = parseInt(Astro.url.searchParams.get('defaultCount') || '0') || undefined;

if (!rarityId || !rarityName || !defaultCount)
	return new Response('Missing required parameters', { status: 400 });

await updateRarity({
	rarityId,
	rarityName,
	defaultCount,
});
---

<body>
	<span id={`rarityName-${rarityId}`} hx-swap-oob="true">{rarityName}</span>
	<span id={`defaultCount-${rarityId}`} hx-swap-oob="true">{defaultCount}</span>
	<button
		@htmx:load="setTimeout(() => { $el.innerText = 'Edit'; $el.dataset.type = 'submit'; }, 1000)"
		class="post-button edit-button w-24"
		data-type="success"
		hx-select=".save-button"
		hx-swap="outerHTML"
		hx-vals={JSON.stringify({ rarityName, rarityId, defaultCount })}
		hx-get={api.RARITY.START_EDIT}>
		Saved
	</button>
</body>
