---
import { useAdmin } from '@/session';
import { openCardFromPack } from '@lil-indigestion-cards/core/card';
const session = useAdmin(Astro.cookies);
if (!session) return Astro.redirect('/404');

if (Astro.request.method !== 'PATCH') return new Response('Method not allowed', { status: 405 });

const params = new URLSearchParams(await Astro.request.text());
const instanceId = params.get('instanceId');
const designId = params.get('designId');

if (!instanceId || !designId) {
	return {
		statusCode: 400,
		body: 'Invalid request body.',
	};
}

//const result = { success: false, error: 'Not implemented' }; // for testing 
const result = await openCardFromPack({ instanceId, designId });

if (result.success) {
	return new Response(null, { status: 200 });
}
---

<p class="text-red-500 font-bold text-center">An error occurred.</p>
