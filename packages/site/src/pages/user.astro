---
import Page from '@/layouts/Page.astro';
import { Icon } from 'astro-icon';
import { getAllUsers } from '@lil-indigestion-cards/core/user';
import TableSearch from '@/components/TableSearch.astro';
import { publicApi, routes } from '@/constants';
import PageHeading from '@/components/text/PageHeading.astro';

const users = await getAllUsers();
---

<Page
	title="Users"
	breadcrumbs={[{ label: 'Home', href: '/' }, { label: 'Users' }]}
	pageType="public">
	<sort-table>
		<header class="page-header">
			<PageHeading>Users</PageHeading>
			<TableSearch
				tableId="user-table"
				label="Search Users"
				id="user-table-search"
				action={publicApi.SEARCH}
			/>
		</header>
		<table id="user-table">
			<thead>
				<tr>
					<th class="w-3/4">Username</th>
					<th data-type="number" data-start-descending>Cards</th>
					<th data-type="number" data-start-descending>Packs</th>
				</tr>
			</thead>
			<tbody>
				{
					users.map(({ username, cardCount, packCount }) => (
						<tr>
							<td>
								<a href={`${routes.USERS}/${username}`}>{username}</a>
							</td>
							<td>
								<Icon name="mdi:cards" aria-hidden="true" />
								<span>{cardCount}</span>
							</td>
							<td>
								<Icon name="mdi:gift" aria-hidden="true" />
								<span>{packCount}</span>
							</td>
						</tr>
					))
				}
			</tbody>
		</table>
	</sort-table>
</Page>
