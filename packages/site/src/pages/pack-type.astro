---
import Page from '@/layouts/Page.astro';
import { Icon } from 'astro-icon';
import { useAdmin } from '@/session';
import { getAllPackTypes } from '@lil-indigestion-cards/core/card';
import { routes } from '@/constants';

const admin = useAdmin(Astro.cookies);
if (!admin) return Astro.redirect(`/?${Astro.url.searchParams.toString()}`);

const packTypes = await getAllPackTypes();
---

<Page
	title="Pack Types"
	breadcrumbs={[{ label: 'Home', href: '/' }, { label: 'Pack Types' }]}
	session={admin}>
	<sort-table>
		<header class="page-header">
			<h1 class="page-heading">Pack Types</h1>
			<a href={routes.ADMIN.CREATE.PACK_TYPE} class="button-link"> Create New Pack Type</a>
		</header>
		<table>
			<thead>
				<tr>
					<th class="w-1/2">Pack Name</th>
					<th>Card Pool</th>
					<th>Cards</th>
				</tr>
			</thead>
			<tbody>
				{
					packTypes.map(
						({ cardCount, packTypeName, packTypeId, packTypeCategory, seasonName }) => (
							<tr>
								<td>
									<a href={`${routes.PACK_TYPES}/${packTypeId}`}>
										{packTypeName}
									</a>
								</td>
								<td>
									<span>
										{packTypeCategory === 'season'
											? seasonName
											: packTypeCategory}
									</span>
								</td>
								<td>
									<Icon name="mdi:cards" aria-hidden="true" />
									<span>{cardCount}</span>
								</td>
							</tr>
						)
					)
				}
			</tbody>
		</table>
	</sort-table>
</Page>
