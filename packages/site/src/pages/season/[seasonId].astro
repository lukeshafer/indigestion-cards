---
import CardList from '@/components/CardList.astro'
import Page from '@/layouts/Page.astro'
import { useAdmin } from '@/session'
import { getSeasonAndDesignsBySeasonId } from '@lil-indigestion-cards/core/card'
import PostButton from '@/components/form/PostButton.astro'
import { api, routes } from '@/constants'

const admin = useAdmin(Astro.cookies)
if (!admin) return Astro.redirect('/404')

const id = Astro.params.seasonId

if (!id) {
	return Astro.redirect(`${routes.SEASONS}?alert=Season ID is required`)
}

const {
	season: [season],
	cardDesigns,
} = await getSeasonAndDesignsBySeasonId(id)

if (!season) {
	return Astro.redirect(`${routes.SEASONS}?alert='${id}' does not exist`)
}

const breadcrumbs = [
	{ label: 'Home', href: '/' },
	{ label: 'Seasons', href: routes.SEASONS },
	{ label: season.seasonName, href: `${routes.SEASONS}/${id}` },
]
---

<Page
	title={season.seasonName}
	class="flex flex-col gap-4"
	session={admin}
	breadcrumbs={breadcrumbs}>
	<h1 class="page-heading">{season.seasonName}</h1>
	<p class="text-lg">Description: {season.seasonDescription}</p>
	<h2 class="text-xl pt-4">Cards:</h2>
	<CardList cards={cardDesigns} />

	<PostButton
		class="bg-red-500 hover:bg-red-700 text-black hover:text-white"
		id="delete-season"
		label="Delete Season"
		url={`${api.DELETE_CARD_SEASON}/${id}?redirect=${routes.SEASONS}`}
	/>
</Page>

<script>
	const form = document.getElementById('delete-season') as HTMLFormElement

	form.addEventListener('submit', async (e) => {
		const confirmation = confirm('Are you sure you want to delete this season?')
		if (!confirmation) e.preventDefault()
	})
</script>
