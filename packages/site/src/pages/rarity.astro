---
import Page from '@/layouts/Page.astro';
import PageHeader from '@/components/text/PageHeader.astro';
import PageHeading from '@/components/text/PageHeading.astro';
import UnmatchedImageList from '@/components/UnmatchedImageList.astro';

import { getAllRarities } from '@lil-indigestion-cards/core/card';
import { api, routes, routeNames } from '@/constants';
import SortTable from '@/components/table/SortTable.astro';
import SortTableHeading from '@/components/table/SortTableHeading.astro';
import SortTableRow from '@/components/table/SortTableRow.astro';
import SortTableCell from '@/components/table/SortTableCell.astro';
import SortTableHead from '@/components/table/SortTableHead.astro';

const rarities = await getAllRarities();
---

<Page title="Rarities" class="flex flex-col gap-4" breadcrumbs={[{ label: routeNames.RARITIES }]}>
	<UnmatchedImageList type="frame" />
	<PageHeader>
		<PageHeading>Rarities</PageHeading>
		<a href={routes.ADMIN.CREATE.RARITY} class="button-link">Create New Rarity</a>
	</PageHeader>
	<SortTable>
		<SortTableHead slot="heading">
			<SortTableHeading>Name</SortTableHeading>
			<SortTableHeading showOnBreakpoint="lg">Id</SortTableHeading>
			<SortTableHeading type="number" showOnBreakpoint="sm">Default Count</SortTableHeading>
			<SortTableHeading sort={false}>Actions</SortTableHeading>
		</SortTableHead>
		{
			rarities.map((rarity) => (
				<SortTableRow class="relative text-center">
					<SortTableCell>
						<span id={`rarityName-${rarity.rarityId}`}>{rarity.rarityName}</span>
					</SortTableCell>
					<SortTableCell showOnBreakpoint="lg">
						<span id={`rarityId-${rarity.rarityId}`}>{rarity.rarityId}</span>
					</SortTableCell>
					<SortTableCell showOnBreakpoint="sm">
						<span id={`defaultCount-${rarity.rarityId}`}>{rarity.defaultCount}</span>
					</SortTableCell>
					<SortTableCell>
						<div class="flex flex-wrap justify-center gap-2 text-sm">
							<button
								class="post-button edit-button w-24"
								data-type="submit"
								hx-select=".save-button"
								hx-swap="outerHTML"
								hx-vals={JSON.stringify({
									rarityName: rarity.rarityName,
									rarityId: rarity.rarityId,
									defaultCount: rarity.defaultCount,
								})}
								hx-get={api.RARITY.START_EDIT}>
								Edit
							</button>
							<button
								class="post-button edit-button w-24"
								data-type="delete"
								hx-swap="none"
								hx-vals={JSON.stringify({
									rarityId: rarity.rarityId,
									frameUrl: rarity.frameUrl,
								})}
								hx-confirm="Are you sure you want to delete this rarity?"
								hx-delete={api.RARITY.DELETE}>
								Delete
								<form-indicator>Deleting</form-indicator>
							</button>
						</div>
					</SortTableCell>
				</SortTableRow>
			))
		}
	</SortTable>
</Page>
