---
import Page from '@/layouts/Page.astro';
import CardListSolid from '@/components/cards/CardList';
import CardListAstro from '@/components/cards/CardList.astro';
import { getAllCardDesigns } from '@lib/design';
import { routeNames } from '@/constants';
import { PageTitle, PageHeader } from '@/components/text';
import { cachePage } from '@/lib/api';
import { mapStream, streamAllCardDesigns } from '@/lib/stream';

const designStream = streamAllCardDesigns();

cachePage(Astro);
---

<Page title="All Cards" breadcrumbs={[{ label: routeNames.CARDS }]} pageType="public">
	<PageHeader>
		<PageTitle>All Cards</PageTitle>
	</PageHeader>
	{designStream}
	<CardListAstro
		pathType="card"
		cards={mapStream(designStream, cards =>
			cards?.map(card => {
				const bestRarity = card.bestRarityFound;

				return {
					...card,
					rarityName: bestRarity?.rarityName ?? '',
					rarityId: bestRarity?.rarityId ?? '',
					frameUrl: bestRarity?.frameUrl ?? '',
					rarityColor: bestRarity?.rarityColor ?? '',
					totalOfType: bestRarity?.count ?? 1,
					cardNumber: 1,
				};
			})
		)}
		sortOnlyBy={['card-name-asc', 'card-name-desc']}
	/>
</Page>
