---
import Page from '@/layouts/Page.astro';
import CardList from '@/components/CardList.astro';
import UnmatchedImageList from '@/components/UnmatchedImageList.astro';
import { getAllCardDesigns } from '@lil-indigestion-cards/core/card';
import { getSiteConfig } from '@lil-indigestion-cards/core/site-config';
import { routeNames, routes } from '@/constants';
import PageHeading from '@/components/text/PageHeading.astro';
import PageHeader from '@/components/text/PageHeader.astro';
import AdminOnly from '@/components/AdminOnly.astro';

const [designs, siteConfig] = await Promise.all([getAllCardDesigns(), getSiteConfig()]);

const message = Astro.url.searchParams.get('message') || '';
---

<Page title="All Cards" breadcrumbs={[{ label: routeNames.CARDS }]}>
	{message ? <p class="bg-green-200 p-4 text-center text-xl">{message}</p> : null}
	<UnmatchedImageList type="cardDesign" />
	<PageHeader>
		<PageHeading>All Cards</PageHeading>
		<AdminOnly>
			<a href={routes.ADMIN.CREATE.CARD_DESIGN} class="button-link">Create New Design</a>
		</AdminOnly>
	</PageHeader>
	<CardList
		cards={designs.map((card) => ({
			...card,
			rarityName: siteConfig?.baseRarity.rarityName ?? '',
			rarityId: siteConfig?.baseRarity.rarityId ?? '',
			frameUrl: siteConfig?.baseRarity.frameUrl ?? '',
			rarityColor: siteConfig?.baseRarity.rarityColor ?? '',
			cardNumber: 1,
			totalOfType: 1,
		}))}
	/>
</Page>
