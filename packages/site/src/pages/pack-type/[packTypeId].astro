---
import { PageTitle, Heading } from '@/components/text';
import DeletePackTypeButton from '@/components/pack-type/DeletePackTypeButton';
import { routeNames } from '@/constants';
import Page from '@/layouts/Page.astro';
import { getPackTypeById } from '@lil-indigestion-cards/core/card';
import { getCardPoolFromType } from '@lil-indigestion-cards/core/pack';
import Table from '@/components/table/Table';
import { Api } from 'sst/node/api';

const packTypeId = Astro.params.packTypeId;
if (!packTypeId) {
	return Astro.redirect('/pack-type?alert=Missing pack type ID');
}

const packType = await getPackTypeById({ packTypeId });
if (!packType) {
	return Astro.redirect('/404?alert=Invalid pack type ID');
}
const cardPool = await getCardPoolFromType(packType);
---

<Page
	title={`Pack Type: ${packType.packTypeName}`}
	breadcrumbs={[
		{ label: routeNames.PACK_TYPES, href: '/pack-type' },
		{ label: packType.packTypeName, href: `/pack-type/${packType.packTypeId}` },
	]}>
	<PageTitle>{packType.packTypeName}</PageTitle>
	<DeletePackTypeButton packTypeId={packType.packTypeId} apiUrl={Api.api.url} client:load />
	<section aria-label="Card Pool" class="mt-4 flex flex-col gap-4 max-w-2xl mx-auto">
		<Heading>Card Pool</Heading>
		<Table
			columns={[
				{
					name: 'cardName',
					label: 'Card Name',
					width: '75%',
					font: 'title',
				},
				{
					name: 'seasonName',
					label: 'Season Name',
				},
			]}
			rows={cardPool.cardDesigns.map((card) => ({
				cardName: card.cardName,
				seasonName: card.seasonName,
			}))}
		/>
	</section>
</Page>
