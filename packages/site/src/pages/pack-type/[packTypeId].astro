---
import SortTable from '@/components/table/SortTable.astro';
import SortTableCell from '@/components/table/SortTableCell.astro';
import SortTableHead from '@/components/table/SortTableHead.astro';
import SortTableHeading from '@/components/table/SortTableHeading.astro';
import SortTableRow from '@/components/table/SortTableRow.astro';
import PageHeading from '@/components/text/PageHeading.astro';
import SubHeading from '@/components/text/SubHeading.astro';
import DeletePackTypeButton from '@/components/pack-type/DeletePackTypeButton';
import { api, routeNames } from '@/constants';
import Page from '@/layouts/Page.astro';
import { getPackTypeById } from '@lil-indigestion-cards/core/card';
import { getCardPoolFromType } from '@lil-indigestion-cards/core/pack';

const packTypeId = Astro.params.packTypeId;
if (!packTypeId) {
	return Astro.redirect('/pack-type?alert=Missing pack type ID');
}

const packType = await getPackTypeById({ packTypeId });
if (!packType) {
	return Astro.redirect('/404?alert=Invalid pack type ID');
}
const cardPool = await getCardPoolFromType(packType);
---

<Page
	title={`Pack Type: ${packType.packTypeName}`}
	breadcrumbs={[
		{ label: routeNames.PACK_TYPES, href: '/pack-type' },
		{ label: packType.packTypeName, href: `/pack-type/${packType.packTypeId}` },
	]}>
	<PageHeading>{packType.packTypeName}</PageHeading>
	<DeletePackTypeButton packTypeId={packType.packTypeId} client:load />
	<section aria-label="Card Pool" class="mt-4 flex flex-col gap-4">
		<SubHeading>Card Pool</SubHeading>
		<SortTable>
			<SortTableHead slot="heading">
				<SortTableHeading width="75%">Card Name</SortTableHeading>
				<SortTableHeading>Season Name</SortTableHeading>
			</SortTableHead>
			{
				cardPool.cardDesigns.map((card) => (
					<SortTableRow>
						<SortTableCell>{card.cardName}</SortTableCell>
						<SortTableCell>{card.seasonName}</SortTableCell>
					</SortTableRow>
				))
			}
		</SortTable>
	</section>
</Page>
