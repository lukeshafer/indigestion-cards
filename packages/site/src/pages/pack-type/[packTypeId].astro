---
import Page from '@/layouts/Page.astro';
import { useAdmin } from '@/session';
import { getPackTypeById } from '@lil-indigestion-cards/core/card';
import { getCardPoolFromType } from '@lil-indigestion-cards/core/pack';
import CardList from '@/components/CardList.astro';
import SortTable from '@/components/SortTable.astro';

const session = useAdmin(Astro.cookies);
if (!session) return Astro.redirect('/404');

const packTypeId = Astro.params.packTypeId;

if (!packTypeId) return Astro.redirect('/pack-type?alert=Missing pack type ID');

const packType = await getPackTypeById({ packTypeId });
if (!packType) return Astro.redirect('/404?alert=Invalid pack type ID');
const cardPool = await getCardPoolFromType(packType);
---

<Page
	title={`Pack Type: ${packType.packTypeName}`}
	session={session}
	breadcrumbs={[
		{ label: 'Home', href: '/' },
		{ label: 'Pack Types', href: '/pack-type' },
		{ label: packType.packTypeName, href: `/pack-type/${packType.packTypeId}` },
	]}>
	<h1 class="page-heading">{packType.packTypeName}</h1>
	<button
		class="post-button shine"
		data-type="delete"
		hx-delete="/api/html/pack-type"
		hx-vals={JSON.stringify({
			packTypeId: packType.packTypeId,
		})}>
		Delete Pack Type
		<div class="htmx-indicator">Deleting</div>
	</button>
	<section aria-label="Card Pool" class="flex flex-col gap-4 mt-4">
		<h2 class="sub-heading">Card Pool</h2>
		<SortTable>
			<thead>
				<tr>
					<th class="w-3/4">Card Name</th>
					<th>Card Type</th>
				</tr>
			</thead>
			<tbody>
				{
					cardPool.cardDesigns.map((card) => (
						<tr>
							<td>{card.cardName}</td>
							<td>{card.seasonName}</td>
						</tr>
					))
				}
			</tbody>
		</SortTable>
	</section>
</Page>
