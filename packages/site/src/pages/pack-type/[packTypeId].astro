---
import SortTable from '@/components/table/SortTable.astro';
import SortTableCell from '@/components/table/SortTableCell.astro';
import SortTableHead from '@/components/table/SortTableHead.astro';
import SortTableHeading from '@/components/table/SortTableHeading.astro';
import SortTableRow from '@/components/table/SortTableRow.astro';
import PageHeading from '@/components/text/PageHeading.astro';
import { api } from '@/constants';
import Page from '@/layouts/Page.astro';
import { getPackTypeById } from '@lil-indigestion-cards/core/card';
import { getCardPoolFromType } from '@lil-indigestion-cards/core/pack';

const packTypeId = Astro.params.packTypeId;
if (!packTypeId) {
	return Astro.redirect('/pack-type?alert=Missing pack type ID');
}

const packType = await getPackTypeById({ packTypeId });
if (!packType) {
	return Astro.redirect('/404?alert=Invalid pack type ID');
}
const cardPool = await getCardPoolFromType(packType);
---

<Page
	title={`Pack Type: ${packType.packTypeName}`}
	breadcrumbs={[
		{ label: 'Home', href: '/' },
		{ label: 'Pack Types', href: '/pack-type' },
		{ label: packType.packTypeName, href: `/pack-type/${packType.packTypeId}` },
	]}>
	<PageHeading>{packType.packTypeName}</PageHeading>
	<button
		class="post-button shine"
		data-type="delete"
		hx-delete={api.PACK_TYPE.DELETE}
		hx-swap="false"
		hx-vals={JSON.stringify({
			packTypeId: packType.packTypeId,
		})}>
		Delete Pack Type
		<div class="htmx-indicator">Deleting</div>
	</button>
	<section aria-label="Card Pool" class="mt-4 flex flex-col gap-4">
		<h2 class="sub-heading">Card Pool</h2>
		<SortTable>
			<SortTableHead slot="heading">
				<SortTableHeading width="75%">Card Name</SortTableHeading>
				<SortTableHeading>Season Name</SortTableHeading>
			</SortTableHead>
			{
				cardPool.cardDesigns.map((card) => (
					<SortTableRow>
						<SortTableCell>{card.cardName}</SortTableCell>
						<SortTableCell>{card.seasonName}</SortTableCell>
					</SortTableRow>
				))
			}
		</SortTable>
	</section>
</Page>
