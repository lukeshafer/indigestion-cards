---
// DATA
import { getAllTradesForUser } from '@lil-indigestion-cards/core/lib/trades';

// UI
import { PageHeader, PageTitle } from '@/components/text';
import { routeNames, routes } from '@/constants';
import Page from '@/layouts/Page.astro';
import { Anchor } from '@/components/text';
import TradesTable from '@/components/trades/TradesTable';

const userId = Astro.locals.user?.properties.userId;
const username = Astro.locals.user?.properties.username;

if (!userId || !username) {
	return Astro.redirect('/?alert=You must be logged in to view this page.&type=error');
}

const trades = await getAllTradesForUser(userId);
---

<Page title="Trades" pageType="user" breadcrumbs={[{ label: routeNames.TRADES }]}>
	<PageHeader>
		<PageTitle>My Trades</PageTitle>
    <div class="flex w-full justify-center sm:w-auto sm:absolute right-4 ">
      <Anchor href={`${routes.TRADES}/new`}>New Trade</Anchor>
    </div>
	</PageHeader>

	<TradesTable
		incomingTrades={trades.incoming}
		outgoingTrades={trades.outgoing}
		loggedInUsername={username}
		client:load
	/>
	<br />
</Page>
