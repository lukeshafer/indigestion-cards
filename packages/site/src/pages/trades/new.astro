---
// UI
import { PageHeader, PageTitle } from '@/components/text';
import { routeNames, routes } from '@/constants';
import Page from '@/layouts/Page.astro';
import NewTrade from '@/components/trades/NewTrade';
import { getUserAndCardInstances } from '@lil-indigestion-cards/core/lib/user';

const { userId, username } = Astro.locals.user?.properties || {};

if (!userId || !username) {
	return Astro.redirect('/?alert=You must be logged in to view this page.&type=error');
}

const { cardInstances } = (await getUserAndCardInstances({ username })) ?? {};
---

<Page
	wide
	title="New Trade"
	breadcrumbs={[{ label: routeNames.TRADES, href: routes.TRADES }, { label: 'New Trade' }]}>
	<PageHeader>
		<PageTitle>New Trade</PageTitle>
	</PageHeader>
	<NewTrade {userId} {username} {cardInstances} client:load />
</Page>
