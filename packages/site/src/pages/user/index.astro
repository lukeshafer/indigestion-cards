---
import Page from '@/layouts/Page.astro'
import { Icon } from 'astro-icon'
import { useUser } from '@/session'
import { getAllUsers } from '@lil-indigestion-cards/core/user'
import SortTable from '@/components/SortTable.astro'
import TableSearch from '@/components/TableSearch.astro'
import { publicApi, routes } from '@/constants'

const user = useUser(Astro.cookies)

const users = await getAllUsers()
---

<Page
	title="Users"
	breadcrumbs={[{ label: 'Home', href: '/' }, { label: 'Users' }]}
	session={user}
	pageType="public">
	<SortTable id="user-table">
		<header class="flex justify-between flex-wrap mb-4" slot="header">
			<h1 class="page-heading">Users</h1>
			<TableSearch
				tableId="user-table"
				label="Search Users"
				id="user-table-search"
				action={publicApi.SEARCH}
			/>
		</header>
		<thead>
			<tr>
				<th class="w-3/4">Username</th>
				<th data-type="number">Cards</th>
				<th data-type="number">Packs</th>
			</tr>
		</thead>
		<tbody>
			{
				users.map(({ username, cardCount, packCount }) => (
					<tr>
						<td>
							<a href={`${routes.USERS}/${username}`}>{username}</a>
						</td>
						<td>
							<Icon name="mdi:cards" aria-hidden="true" />
							<span>{cardCount}</span>
						</td>
						<td>
							<Icon name="mdi:gift" aria-hidden="true" />
							<span>{packCount}</span>
						</td>
					</tr>
				))
			}
		</tbody>
	</SortTable>
</Page>
